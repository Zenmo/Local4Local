
services:
    npm-base:
        image: node:22
        working_dir: /webtool/frontend
        volumes:
            - .:/webtool
        command: ["npm", "install"]

    frontend:
        extends:
            service: npm-base
        command: ["npm", "run", "dev"]
        ports:
            - "127.0.0.1:5173:5173"

    postgres:
        image: postgres:16
        environment:
            POSTGRES_USER: webtool
            POSTGRES_PASSWORD: webtool

    gradle-base:
        image: gradle:8.9
        working_dir: /home/gradle/project
        user: gradle
        volumes:
            - ./gradle:/home/gradle/project
            - gradle-user-home:/home/gradle/.gradle

    gradle-js:
        extends:
            service: gradle-base
        command: ["gradle", "--project-cache-dir=/tmp/gradle", "--no-daemon", "common:jsBrowserProductionLibraryDistribution"]

    backend:
        extends:
            service: gradle-base
        command: ["gradle", "--project-cache-dir=/tmp/gradle", "backend:run"]
        ports:
            -   target: 9000
                host_ip: 127.0.0.1
                published: 9000

volumes:
    # shared cache of libraries
    gradle-user-home:
